<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>mismith.github.io</title>
	<style>
		html,
		body {
			margin: 0;
		}
		body {
			font-family: sans-serif;
			padding: 10px;
		}
		#app > header {
			display: flex;
			justify-content: center;
			padding: 10px;
		}
		#repos {
			-webkit-column-count: 3;
			-webkit-column-gap: 10px;
		}
		@media (max-width: 1080px) {
			#repos {
				-webkit-column-count: 2;
			}
		}
		@media (max-width: 640px) {
			#repos {
				-webkit-column-count: 1;
			}
		}
		article {
			background-color: #eee;
			-webkit-column-break-inside: avoid;
			padding: 10px;
			margin-bottom: 10px;
		}
		article h1 {
			margin-top: 0;
		}
		a {
			color: #333;
			text-decoration: none;
		}
	</style>
</head>
<body>
	<main id="app">
		<header>
			<input type="search" v-model="filter" placeholder="Filter" autofocus />
			<select v-model="sorting">
				<option value="pushed_at" selected>Pushed</option>
				<option value="created_at">Created</option>
				<option value="name">Name</option>
			</select>
		</header>
		<div id="repos">
			<article v-for="repo of repos | filterBy repoExcludes | filterBy filter in 'name' 'description' | orderBy order direction">
				<h1>
					<a :href="repo.$url">{{ repo.name }}</a>
					<a v-if="repo.$url !== repo.html_url" :href="repo.html_url" title="Repo">
						<svg aria-hidden="true" class="octicon octicon-repo" height="16" role="img" version="1.1" viewBox="0 0 12 16" width="12">
							<path d="M4 9h-1v-1h1v1z m0-3h-1v1h1v-1z m0-2h-1v1h1v-1z m0-2h-1v1h1v-1z m8-1v12c0 0.55-0.45 1-1 1H6v2l-1.5-1.5-1.5 1.5V14H1c-0.55 0-1-0.45-1-1V1C0 0.45 0.45 0 1 0h10c0.55 0 1 0.45 1 1z m-1 10H1v2h2v-1h3v1h5V11z m0-10H2v9h9V1z"></path>
						</svg>
					</a>
				</h1>
				<div>{{ repo.description }}</div>
			</article>
		</div>
	</main>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.25/browser.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/3.2.1/es6-promise.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.21/vue.js"></script>
	<script type="text/javascript">
		let excludes = [
			'mismith.github.io',
		];

		// app
		let app = new Vue({
			el: '#app',
			data: {
				filter: '',
				sorting: 'recent',
				repos: [],
			},
			computed: {
				order: function() {
					switch(this.sorting) {
						default: return this.sorting;
					}
				},
				direction: function() {
					switch(this.sorting) {
						case 'created_at':
						case 'pushed_at': return -1;
						default: return 1;
					}
				},
			},
			methods: {
				repoExcludes: function (repo) {
					if (repo.fork || ! repo.description || repo.description.indexOf('WIP') >= 0) return;
					if (excludes.indexOf(repo.name) >= 0) return;
					return true;
				},
			},
			created: function() {
				fetch('https://api.github.com/users/mismith/repos?type=owner')
					.then(res => res.json())
					.then(repos => {
						this.repos = repos.map(repo => {
							repo.$url = repo.homepage || (repo.has_pages ? `https://${repo.owner.login}.github.io/${repo.name}/` : repo.html_url);
							return repo;
						});
					});
			},
		});
	</script>
</body>
</html>
